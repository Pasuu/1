<!DOCTYPE html>
<html>
<body>
  <h1>文件上传</h1>
  
  <input type="file" id="fileInput">
  <button onclick="uploadFile()">上传文件</button>
  
  <div id="result" style="margin-top: 20px"></div>

  <script>
  async function uploadFile() {
    const fileInput = document.getElementById('fileInput');
    const resultDiv = document.getElementById('result');
    
    if (!fileInput.files.length) {
      resultDiv.innerHTML = '<p>请选择文件</p>';
      return;
    }

    const file = fileInput.files[0];
    
    // 验证文件大小 (免费版限制4.5MB)
    if (file.size > 4.5 * 1024 * 1024) {
      resultDiv.innerHTML = '<p>文件太大，最大支持4.5MB</p>';
      return;
    }

    const formData = new FormData();
    formData.append('file', file);

    try {
      resultDiv.innerHTML = '<p>上传中...</p>';
      
      const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) throw new Error(await response.text());
      
      const data = await response.json();
      resultDiv.innerHTML = `
        <p>✅ 上传成功!</p>
        <p>文件地址: <a href="${data.url}" target="_blank">${data.url}</a></p>
        ${file.type.startsWith('image/') ? 
          `<img src="${data.url}" alt="预览" style="max-width:300px">` : ''}
      `;
    } catch (error) {
      resultDiv.innerHTML = `<p>❌ 上传失败: ${error.message}</p>`;
    }
  }
  </script>
</body>
</html>